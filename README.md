# 機材貸出管理システム (Demo Unit Loan Management)

デモ機や医療機器の貸出・在庫管理を行うための Streamlit アプリケーションです。
在庫ごとのステータス管理、貸出・返却時の構成品チェック、写真記録、不具合（Issue）管理機能を備え、厳格なトレーサビリティを実現します。
最新のアップデートにより、洗練されたホワイトベースのデザインと直感的なUIに刷新されました。

## 主な機能

### 1. デザイン & UI (New)
- **モダンでスタイリッシュなホワイトベースデザイン**: 視認性の高い「Noto Sans JP」フォントと、アクセントカラー（ディープブルー）を採用。
- **カード型UI**: 各情報をカード形式で整理し、縦方向の中央揃え配置により情報の視認性を向上。
- **Material Symbolsアイコン**: Google Material Symbolsを使用し、洗練された印象に統一。
- **共通ヘッダー**: ログイン画面から設定画面まで、アプリケーション全体で統一されたナビゲーション体験を提供。

### 2. 在庫管理
- カテゴリ > 機種 > ロット の階層で機器を管理
- 各ロットのステータス管理（在庫あり、貸出中、要対応）
- ロットごとの構成品カスタマイズ（個体差分）機能

### 3. マスタ管理
- **機種・構成品管理**: 管理者による機種や構成品の登録・編集・削除機能。
- **テンプレート管理**: ブレークダウン/セット品に対応したテンプレート管理。
- **編集・削除機能 (Enhanced)**: 機種名の変更や、関連データ（ユニット、履歴等）を含めた機種の完全削除（カスケード削除）が可能になりました。

### 4. 貸出管理 (Checkout)
- **貸出登録**: 持出日、貸出先、目的を記録。
- **構成品チェック**: 機種や個体に応じたチェックリスト（OK/NG判定）。
- **写真記録**: 貸出時の状態を写真で保存（必須）。
- **異常検知**: NG項目がある場合、自動的に「要対応」ステータスへ移行し、貸出禁止ロックがかかります。

### 5. 返却管理 (Return)
- **返却登録**: 貸出履歴に基づく返却処理。
- **状態自動判定**: 返却時のチェック結果と既存の不具合状況に基づき、ステータスを自動更新。
- **写真・チェック**: 返却時も貸出時と同様に写真とチェックリストを必須化。

### 6. 不具合・取消管理
- **Issue管理**: 不具合の記録と解消（Resolve）フロー。
- **取消機能 (Undo)**: 誤操作時のための貸出・返却取消機能。履歴と在庫ステータスを整合性を保ってロールバックします。

### 7. 通知・分析 (Notification & Analytics)
- **アラート通知**: 不具合発生時に、カテゴリごとの通知グループへ自動ログ記録（SMTP設定によるメール通知も対応）。
- **稼働率分析**: 期間指定によるユニットごとの稼働率計算・レポート表示。
- **ダッシュボード**: ホーム画面でのリアルタイム件数表示（在庫・貸出中・要対応）。アラート時にはトースト通知も表示。

## 技術スタック
- **Frontend/Backend**: Python (Streamlit)
- **Database**: SQLite (`data/app.db`)
- **UI Styling**: Custom CSS (`src/styles.py`), Material Symbols Rounded
- **Environment**: Windows 11 (PowerShell)

## ディレクトリ構成
- `src/`: ソースコード
  - `views/`: 画面UIコンポーネント
    - `home.py`: ホーム・ダッシュボード
    - `master.py`: マスタ管理
    - `loan.py`, `return_view.py`: 貸出・返却フロー
    - `analytics.py`: 稼働率分析
    - `settings.py`: 通知設定・SMTP設定
    - `login.py`, `setup.py`: 認証・初期設定
  - `styles.py`: グローバルCSS定義・デザイン調整
  - `ui.py`: 共通UIコンポーネント（ヘッダー等）
  - `database.py`: データベース操作
  - `logic.py`: ビジネスロジック
  - `auth.py`: 認証機能
- `data/`: データ保存先
  - `uploads/`: アップロード画像（貸出/返却セッションごとに整理）
- `.venv/`: 仮想環境

## セットアップと実行

### 必要要件
- Python 3.10+

### インストール (Windows)
1. **初期セットアップ**:
   ```powershell
   install_deps.bat
   ```

### 初期アカウント
- **Email**: `admin@example.com`
- **Password**: `admin123`

### アプリケーションの起動
```powershell
run_app.bat
```
または
```powershell
& ".venv\Scripts\streamlit" run app.py
```
ブラウザが開き、[http://localhost:8501](http://localhost:8501) で利用可能です。

## 開発・検証スクリプト
- `verify_phase0.py` ~ `verify_phase5.py`: 各機能フェーズの自動検証用スクリプト
